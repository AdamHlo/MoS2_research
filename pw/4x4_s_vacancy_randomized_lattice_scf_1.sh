#!/bin/bash
#SBATCH -N 4
#SBATCH --ntasks-per-node=64
#SBATCH -o slurm.txt
#SBATCH -e slurm.txt
#SBATCH --account=p376-23-1

module load QuantumESPRESSO/7.2-intel-2022a

JOB_NAME='4x4_s_vacancy_randomized_lattice_scf_1'


DT=`date +"%d-%b-%Y_%H-%M-%S"`
OUT_DIR="out/${JOB_NAME}_${DT}"
INP_FILE="${OUT_DIR}/input.in"
OUTPUT_FILE="${OUT_DIR}/output.out"

mkdir -p "$OUT_DIR"


cat > $INP_FILE << EOF

&CONTROL
  calculation = 'scf'
  outdir = '${OUT_DIR}'
  prefix = 'mos2'
  pseudo_dir = './pseudo/'
  restart_mode = 'from_scratch'
  verbosity = 'high'
  wf_collect = .true.
/
&SYSTEM
  ecutwfc = 50
  ecutrho = 400
  ibrav = 0
  nat = 47
  ntyp = 2
  nosym = .true.
/
&ELECTRONS
  conv_thr = 0.000001
  diagonalization = 'cg'
/
&CELL
/
ATOMIC_SPECIES
Mo    95.95    Mo_ONCV_PBE-1.0.oncvpsp.upf
S     32.06    s_pbe_v1.4.uspp.F.UPF

ATOMIC_POSITIONS angstrom
Mo    1.5166364709604885    0.428014313644257    25.073147689147504
S    1.5682024373601173    2.33664573403652    26.550754706855688
S    1.5283581494172296    2.3229115901808717    23.470910876262575
Mo    0.026733527271298393    3.2114721540329794    25.001723016485794
S    0.01419015598405418    5.049952603835271    26.569393403421437
S    0.02678948978294256    5.053067149942977    23.482489755268283
Mo    -1.5817027040605123    5.980480672243547    25.001840944956708
S    -1.592870280717353    7.7458598632089455    26.565559189375723
S    -1.5485231232606023    7.761355611646872    23.530657967339465
Mo    -3.162785103576043    8.682586320892762    24.994216001197763
S    -3.159956556993998    10.498136698842139    26.56395879065853
S    -3.1941627465163216    10.55794033685105    23.484022281245288
Mo    4.75439781841746    0.4493940441196163    24.957412574012185
S    4.769796067008963    2.3371194318726345    26.48462218384916
S    4.770026686591848    2.2988843959208354    23.36622654166395
Mo    3.1513812445951146    3.2638253431826194    24.97842952434415
S    3.1854918213013277    5.033664292988549    26.604397073659587
S    3.165072628623379    4.966922987026479    23.466151448614703
Mo    1.5726030888848133    5.95995987080032    25.12304836857932
S    1.6388929672270474    7.742482883030342    26.556224774059128
S    1.6479017119064892    7.746145290978674    23.407606792589604
Mo    -0.009392052556654856    8.660025349243242    24.984275482681348
S    0.04217532313433752    10.621910222945862    26.502680013214928
S    0.036502697615322745    10.54108943836972    23.442073392871748
Mo    7.874967627896313    0.493379107550387    24.942873828998014
S    7.894112789421748    2.2970699664339094    23.362863352024558
Mo    6.402604791317993    3.2283233969147482    25.004841502052432
S    6.383887636218384    5.055172481259775    26.450217264849393
S    6.368859500375379    4.98586063465501    23.350992124797415
Mo    4.731725599825387    5.917044802081119    25.00707784606518
S    4.7852840084409936    7.84362482003691    26.518841017178097
S    4.61635003457744    7.756288651531134    23.446832420609528
Mo    3.180657661512914    8.745981304827652    25.020650900834024
S    3.058289674757475    10.577313818770419    26.611402881379835
S    3.164663205593955    10.513235231116129    23.42957301593122
Mo    11.094874443624514    0.45004878047460406    25.027727992542506
S    10.98119821406446    2.1850762311931655    26.5218051329236
S    11.046993993033606    2.3552164843168297    23.382117892083162
Mo    9.452169808511918    3.204669572973233    24.9214013126836
S    9.491370069686129    5.02924190929736    26.662502377454867
S    9.484498081211166    5.0054934683994485    23.366306701148655
Mo    7.918832787779892    5.959376386824705    25.015149968451116
S    7.926367921751616    7.712019473926653    26.534270327233752
S    7.922752856557661    7.738376494608769    23.4410902221327
Mo    6.354919122611911    8.696228061588505    24.96466516819095
S    6.333487934892862    10.506252126400847    26.481786749615278
S    6.3106824558963295    10.55927176308569    23.452259185322987

CELL_PARAMETERS angstrom
12.651922535508914    -4.3663250128404126e-07    0.0
-6.3259616458894525    10.956886648195539    0.0
0.0    0.0    50.00000719928987


K_POINTS gamma
EOF

mpirun -np 256 pw.x -inp $INP_FILE > $OUTPUT_FILE
