#!/bin/bash
#SBATCH -N 4
#SBATCH --ntasks-per-node=64
#SBATCH -o slurm.txt
#SBATCH -e slurm.txt
#SBATCH --account=p376-23-1

module load QuantumESPRESSO/7.2-intel-2022a

JOB_NAME='4x4_s_vacancy_randomized_lattice_scf_3'


DT=`date +"%d-%b-%Y_%H-%M-%S"`
OUT_DIR="out/${JOB_NAME}_${DT}"
INP_FILE="${OUT_DIR}/input.in"
OUTPUT_FILE="${OUT_DIR}/output.out"

mkdir -p "$OUT_DIR"


cat > $INP_FILE << EOF

&CONTROL
  calculation = 'scf'
  outdir = '${OUT_DIR}'
  prefix = 'mos2'
  pseudo_dir = './pseudo/'
  restart_mode = 'from_scratch'
  verbosity = 'high'
  wf_collect = .true.
/
&SYSTEM
  ecutwfc = 50
  ecutrho = 400
  ibrav = 0
  nat = 47
  ntyp = 2
  nosym = .true.
/
&ELECTRONS
  conv_thr = 0.000001
  diagonalization = 'cg'
/
&CELL
/
ATOMIC_SPECIES
Mo    95.95    Mo_ONCV_PBE-1.0.oncvpsp.upf
S     32.06    s_pbe_v1.4.uspp.F.UPF

ATOMIC_POSITIONS angstrom
Mo    1.5570465066523291    0.4168469995083506    25.007070436613095
S    1.638730112307158    2.24428202925271    26.613215547520525
S    1.6966177502336826    2.241997477557069    23.402835213885027
Mo    0.004012780591872137    3.198901420792436    24.97103644536962
S    0.07278675656126284    5.043110181017295    26.663904049183305
S    -0.0858494622296226    5.00610291527375    23.417422832238394
Mo    -1.5555947374474246    5.9422757216719715    25.10065684899772
S    -1.6723962014051206    7.770135756019769    26.607178273335688
S    -1.5962094207506834    7.75058787583013    23.486833708431135
Mo    -3.1492318609969248    8.72197064551745    24.970373429900224
S    -3.224342169258928    10.564830058705347    26.617379150872154
S    -3.1980010932559755    10.452078604023262    23.378234999908177
Mo    4.767483334832452    0.41708065673329425    24.93692936729066
S    4.820201664668014    2.3451995567414206    26.43242752524466
S    4.75329042659672    2.3092710528497173    23.40675586248674
Mo    3.270992466569469    3.187283866031586    24.92038123818023
S    3.24106984511163    5.010166191413774    26.571538007168648
S    3.065277311709049    5.057566213098949    23.44925322525741
Mo    1.501796641746351    5.927987778827485    25.11630057834303
S    1.570538581152722    7.7467292619168795    26.57003716957889
S    1.6763764286217828    7.706978583873908    23.446210920640752
Mo    -0.03347098303820429    8.671503016912885    25.006985678888675
S    0.12057550820475661    10.554945056814399    26.615626098834326
S    0.07805860119493953    10.527106580834934    23.34949039968121
Mo    7.84321760213959    0.4688552965948378    24.968752913723392
S    7.928713553393788    2.208247684767831    23.418105316384732
Mo    6.298589865107515    3.22507363330243    24.894514451326614
S    6.377128592949416    4.991928462021488    26.555205985755663
S    6.371088285221358    4.990036570679436    23.414460900691303
Mo    4.85925079450001    5.8408482189410815    25.042300925737422
S    4.813808406564779    7.740617034878668    26.54960356668474
S    4.7719832082072795    7.759048299934257    23.538002950773297
Mo    3.113126488403591    8.619917457785052    25.071199769831964
S    3.1055519572017487    10.458396544285135    26.444329903036888
S    3.1950112922938034    10.45637466401959    23.352689724188554
Mo    11.09844714507967    0.5033372583615475    24.990981710700595
S    10.985644864396402    2.2432357772658    26.537676791351366
S    11.095845408964284    2.2738171196961106    23.518342553668823
Mo    9.485841047894668    3.1454356284282983    24.93331868218066
S    9.497258059305029    4.998064936604858    26.527672163962205
S    9.480036409029498    4.960379153771042    23.435738609093566
Mo    7.8875805257661185    5.903880073919615    25.021523468857026
S    7.8700055758546705    7.686787167386486    26.564816296647226
S    7.904490541970192    7.8438225990051365    23.426418049587667
Mo    6.2839697343878544    8.666746347368894    25.07005036182617
S    6.141798869953922    10.435416082725357    26.552672838534065
S    6.3098321988301995    10.446549442907035    23.32060930940693

CELL_PARAMETERS angstrom
12.651922535508914    -4.3663250128404126e-07    0.0
-6.3259616458894525    10.956886648195539    0.0
0.0    0.0    50.00000719928987


K_POINTS gamma
EOF

mpirun -np 256 pw.x -inp $INP_FILE > $OUTPUT_FILE
