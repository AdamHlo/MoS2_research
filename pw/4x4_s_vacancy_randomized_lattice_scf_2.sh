#!/bin/bash
#SBATCH -N 4
#SBATCH --ntasks-per-node=64
#SBATCH -o slurm.txt
#SBATCH -e slurm.txt
#SBATCH --account=p376-23-1

module load QuantumESPRESSO/7.2-intel-2022a

JOB_NAME='4x4_s_vacancy_randomized_lattice_scf_2'


DT=`date +"%d-%b-%Y_%H-%M-%S"`
OUT_DIR="out/${JOB_NAME}_${DT}"
INP_FILE="${OUT_DIR}/input.in"
OUTPUT_FILE="${OUT_DIR}/output.out"

mkdir -p "$OUT_DIR"


cat > $INP_FILE << EOF

&CONTROL
  calculation = 'scf'
  outdir = '${OUT_DIR}'
  prefix = 'mos2'
  pseudo_dir = './pseudo/'
  restart_mode = 'from_scratch'
  verbosity = 'high'
  wf_collect = .true.
/
&SYSTEM
  ecutwfc = 50
  ecutrho = 400
  ibrav = 0
  nat = 47
  ntyp = 2
  nosym = .true.
/
&ELECTRONS
  conv_thr = 0.000001
  diagonalization = 'cg'
/
&CELL
/
ATOMIC_SPECIES
Mo    95.95    Mo_ONCV_PBE-1.0.oncvpsp.upf
S     32.06    s_pbe_v1.4.uspp.F.UPF

ATOMIC_POSITIONS angstrom
Mo    1.5642059585096872    0.493564906517996    24.979346492666046
S    1.5650041952545724    2.2833511931627086    26.576670483934457
S    1.6297729536798302    2.352504135246222    23.507731688104116
Mo    -0.014480041519859965    3.177752273548891    24.950515240734102
S    0.01765106099264535    4.928841379976604    26.469442406811012
S    0.018803481884243023    4.897882209355902    23.473582131517222
Mo    -1.6606044901737411    5.90034648013397    24.972295518914613
S    -1.516179818347305    7.735955316953656    26.622703156298144
S    -1.5969990839873531    7.731361560730889    23.503257499774957
Mo    -3.10662309888178    8.622443269018975    24.995535977162362
S    -3.0750746932902673    10.59555315182068    26.575152957675705
S    -3.04197505524915    10.57157167736831    23.44413517847816
Mo    4.674471864348868    0.3755448275633032    24.971682310498274
S    4.859762300059041    2.32729975312033    26.555043740148143
S    4.805953592636211    2.287631459811    23.43855390254242
Mo    3.1443576150348034    3.2054772140935124    24.934585928383203
S    3.231958954131704    5.076884323330718    26.633339847604102
S    3.201611687666414    4.937862613262863    23.49146505316476
Mo    1.6420859414614037    5.902312781482502    25.069270369554438
S    1.612579808852435    7.87727121793694    26.576412796838234
S    1.6181866162086462    7.785747370825935    23.545131210042832
Mo    -0.05031689853188494    8.730227676607392    25.004318014353135
S    -0.008496755085065158    10.561727101374004    26.604143397709898
S    0.01289032793176909    10.519717626888069    23.478574463649284
Mo    7.881998037260231    0.5140794849022141    24.96056452365653
S    7.840289490275547    2.2801785231475984    23.437708485135698
Mo    6.350244997791786    3.2215022079711235    24.997699123199148
S    6.3764465026684025    5.019022890396351    26.566106250774737
S    6.323637933831777    4.94628560978276    23.426032210522663
Mo    4.7361451730965305    5.988250516719504    25.037556115695427
S    4.732563868982369    7.789018154215091    26.53704677525422
S    4.738257276823475    7.726624338763741    23.57835958400247
Mo    3.1187483371969704    8.66999988582111    24.986472918856872
S    3.0980605275581556    10.525119966641414    26.58637184893637
S    3.158919657090877    10.553175977827475    23.414149333292062
Mo    11.089733324840267    0.45075251760124746    24.962214671402492
S    11.051212274794743    2.3481393617979056    26.50668063441565
S    11.051282787041892    2.2780100411894093    23.418100954629672
Mo    9.456303898274527    3.3483422905086844    24.915476195046583
S    9.460172673723411    4.863347866852968    26.619586955298416
S    9.492636139645967    5.097221686437274    23.372401508424907
Mo    7.949772755361158    5.903432142005008    25.012168931936955
S    7.907817809744283    7.708287545235035    26.562959125008458
S    7.88683964722621    7.714339762688153    23.450141563953643
Mo    6.299259956231437    8.617635525385733    24.973165652601526
S    6.276480007303391    10.604959640575178    26.502704160432934
S    6.3085716328742745    10.544394561822035    23.426896138589782

CELL_PARAMETERS angstrom
12.651922535508914    -4.3663250128404126e-07    0.0
-6.3259616458894525    10.956886648195539    0.0
0.0    0.0    50.00000719928987


K_POINTS gamma
EOF

mpirun -np 256 pw.x -inp $INP_FILE > $OUTPUT_FILE
