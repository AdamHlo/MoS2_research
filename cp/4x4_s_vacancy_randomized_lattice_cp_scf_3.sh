#!/bin/bash
#SBATCH -N 3
#SBATCH --ntasks-per-node=64
#SBATCH -o slurm.txt
#SBATCH -e slurm.txt
#SBATCH --account=p376-23-1

module load QuantumESPRESSO/7.2-intel-2022a

JOB_NAME='4x4_s_vacancy_randomized_lattice_cp_scf_3'


DT=`date +"%d-%b-%Y_%H-%M-%S"`
OUT_DIR="out/${JOB_NAME}_${DT}"
INP_FILE="${OUT_DIR}/input.in"
OUTPUT_FILE="${OUT_DIR}/output.out"

mkdir -p "$OUT_DIR"


cat > $INP_FILE << EOF

&CONTROL
  calculation = 'scf'
  iprint = 1
  isave = 1
  ndr = 50
  ndw = 50
  nstep = 1
  outdir = '${OUT_DIR}'
  prefix = 'mos2'
  pseudo_dir = '../pw/pseudo/'
  restart_mode = 'from_scratch'
  verbosity = 'high'
/
&SYSTEM
  ecutwfc = 50
  ecutrho = 400
  ibrav = 0
  nat = 47
  ntyp = 2
  nr1b = 24,
  nr2b = 24,
  nr3b = 24
/
&ELECTRONS
  orthogonalization = 'ortho'
  electron_dynamics = 'cg'
  electron_maxstep = 100
  conv_thr = 0.000001
/
&CELL
/
ATOMIC_SPECIES
Mo    95.95    Mo_ONCV_PBE-1.0.oncvpsp.upf
S     32.06    s_pbe_v1.4.uspp.F.UPF

ATOMIC_POSITIONS angstrom
Mo    1.585235372113945    0.4505017676185757    25.05136511174453
S    1.6163348806328228    2.2658750457764896    26.537000598640795
S    1.5945771993232767    2.2931613349584703    23.368199229560904
Mo    -0.025965703283175677    3.215438534224277    25.03217076102403
S    -0.015018231553637556    4.976483156956951    26.612453710680782
S    0.041892253531326244    5.031837166558528    23.34409784955706
Mo    -1.5969257978721172    5.847074683545919    24.94749498504736
S    -1.5647335186058402    7.779598905911845    26.570645390606085
S    -1.675661138239522    7.825176468043706    23.45774470349767
Mo    -3.0977119469739303    8.641030503796664    25.049559634329157
S    -3.1603223046937603    10.5124611316957    26.512156149687247
S    -3.2143085620506486    10.446159384380937    23.537832498636035
Mo    4.833612848398339    0.4417737206138742    24.910437029344347
S    4.852057501229498    2.383093297588888    26.546569775338753
S    4.782903037326278    2.2911626505569496    23.455600910297452
Mo    3.110877883124224    3.1979793196175472    25.008463146673822
S    3.1669389037230755    5.04835101423699    26.482263909448427
S    3.1426395751322733    5.009843679664753    23.502109435225037
Mo    1.5498662125425557    5.974243932491524    24.98854316266619
S    1.6121700760116613    7.762896849439212    26.622228260794426
S    1.602860242840575    7.814445005989418    23.35788743531381
Mo    0.03740463843522315    8.695785730247042    25.03154028128419
S    0.025436729111860693    10.58664441652607    26.613084044584912
S    0.039786119914765855    10.472809556971477    23.44518777906697
Mo    7.93426866055888    0.4776622258311216    24.97237668467077
S    7.8582495062215845    2.2892379036601143    23.304450906925258
Mo    6.390550650255507    3.1678201748888655    24.920194229444167
S    6.3426900071573655    4.939658894668182    26.55392918039262
S    6.315313665136359    4.8922382347563325    23.40667642683639
Mo    4.836468295841707    5.966926498285486    25.018019802908896
S    4.76043690721286    7.750448239271988    26.55924007214301
S    4.751375288302759    7.762501273665185    23.479000064590306
Mo    3.204174058580194    8.747956457222681    24.99410983931922
S    3.162663642239207    10.565471460397866    26.495769992462797
S    3.054009659592626    10.568765263229372    23.37172361264133
Mo    11.10974432590324    0.49102583178041975    24.92536167848741
S    10.98369975056351    2.282101060982136    26.556541104299903
S    11.093161074447295    2.3217801551537423    23.368192487855108
Mo    9.465031536455228    3.1800527347457286    24.97474607504347
S    9.45112326099282    4.983324620829841    26.550654932352725
S    9.444240686017459    4.9953533282183    23.36997972470795
Mo    7.921898137836282    5.757794378519923    24.904961558952078
S    7.905699629280927    7.768281893221846    26.610462835222094
S    7.910547086702862    7.798368681629828    23.42248186753267
Mo    6.41840258244943    8.614856505900383    25.063089758971238
S    6.370040513179528    10.471008626019268    26.54783303323732
S    6.228951182957705    10.538234659706315    23.48776839636427

CELL_PARAMETERS angstrom
12.651922535508914    -4.3663250128404126e-07    0.0
-6.3259616458894525    10.956886648195539    0.0
0.0    0.0    50.00000719928987

EOF

mpirun -np 192 pw.x -inp $INP_FILE > $OUTPUT_FILE
