#!/bin/bash
#SBATCH -N 3
#SBATCH --ntasks-per-node=64
#SBATCH -o slurm.txt
#SBATCH -e slurm.txt
#SBATCH --account=p376-23-1

module load QuantumESPRESSO/7.2-intel-2022a

JOB_NAME='4x4_s_vacancy_randomized_lattice_cp_scf_1'


DT=`date +"%d-%b-%Y_%H-%M-%S"`
OUT_DIR="out/${JOB_NAME}_${DT}"
INP_FILE="${OUT_DIR}/input.in"
OUTPUT_FILE="${OUT_DIR}/output.out"

mkdir -p "$OUT_DIR"


cat > $INP_FILE << EOF

&CONTROL
  calculation = 'scf'
  iprint = 1
  isave = 1
  ndr = 50
  ndw = 50
  nstep = 1
  outdir = '${OUT_DIR}'
  prefix = 'mos2'
  pseudo_dir = '../pw/pseudo/'
  restart_mode = 'from_scratch'
  verbosity = 'high'
/
&SYSTEM
  ecutwfc = 50
  ecutrho = 400
  ibrav = 0
  nat = 47
  ntyp = 2
  nr1b = 24,
  nr2b = 24,
  nr3b = 24
/
&ELECTRONS
  orthogonalization = 'ortho'
  electron_dynamics = 'cg'
  electron_maxstep = 100
  conv_thr = 0.000001
/
&CELL
/
ATOMIC_SPECIES
Mo    95.95    Mo_ONCV_PBE-1.0.oncvpsp.upf
S     32.06    s_pbe_v1.4.uspp.F.UPF

ATOMIC_POSITIONS angstrom
Mo    1.5373709776376399    0.4320723939330289    25.103517316995365
S    1.5313735264039157    2.230445346679667    26.59338972695266
S    1.4391248472069451    2.326259466661841    23.447914271040595
Mo    -0.026782309440156547    3.1755635821445556    25.00029577126266
S    -0.03747624305778162    5.030899618854889    26.597720751277024
S    -0.0633152883135997    5.100140398259664    23.532098226534607
Mo    -1.6572722177182653    5.984571736354433    25.030636961474986
S    -1.5781178855326223    7.73861691946738    26.585564803382084
S    -1.513922019719423    7.791735033326483    23.548658820069157
Mo    -3.217128780002239    8.716240016689767    25.03544141199934
S    -3.102202031708495    10.501957112736967    26.639361384070703
S    -3.163564190868146    10.511537038721693    23.418237305235152
Mo    4.773806492429054    0.43881161835704385    24.98686035005906
S    4.821648450253867    2.3167801196800344    26.473107104133003
S    4.787421311814641    2.301786029913676    23.476260196179517
Mo    3.1369244512376335    3.223487570474084    25.086289648748565
S    3.207073805977756    4.988750454597336    26.55340614161093
S    3.243919405994824    5.003984378589904    23.46333367945381
Mo    1.5862904257665704    5.9444755541060195    25.03626920216507
S    1.5974453386732643    7.741499653965004    26.631929145924044
S    1.5773453059950322    7.730309462912676    23.602796609321583
Mo    -0.042538947204414326    8.66454682521756    25.02760983251633
S    0.019146673375388164    10.54507434345709    26.512473124468322
S    0.004726920394123903    10.513857283822029    23.39607764746187
Mo    7.878473232397794    0.5795179035132982    24.890783286472576
S    7.955822182125512    2.245986993917978    23.43759973370636
Mo    6.412568207189689    3.3023618366733682    24.907156103711294
S    6.4200640458932465    4.992827355720911    26.584892522369326
S    6.217015311431051    5.042887995520605    23.3493844369542
Mo    4.719828678569165    5.8947258622692775    25.05348149512204
S    4.80363565744602    7.786005777444178    26.606099480842595
S    4.863917915026225    7.792256250379394    23.441393097098928
Mo    3.095665337826864    8.694877405937204    25.056742544714616
S    3.079041237327906    10.564713978174908    26.648347225202915
S    3.136960643735498    10.577039535278674    23.35527359042638
Mo    11.01993666928867    0.4572106733260791    24.964825557457
S    11.012710298757446    2.2305704359050833    26.52640252503701
S    11.078881227110795    2.257217847413698    23.2898158258221
Mo    9.4420604107871    3.2822668336516907    24.94697286576835
S    9.433484984262563    5.009537481611934    26.562053115918975
S    9.567853302363988    5.004725091821764    23.45847207972903
Mo    7.849075704674127    5.904095373354312    25.112157631414348
S    7.8790714044568935    7.855950342105303    26.477122051146722
S    7.820625172415707    7.7823812764585    23.515477287288288
Mo    6.229272724538695    8.669338952185722    25.012217221441052
S    6.249729786691967    10.444846467771887    26.565759645447955
S    6.312936365037962    10.519756883874726    23.404068814178427

CELL_PARAMETERS angstrom
12.651922535508914    -4.3663250128404126e-07    0.0
-6.3259616458894525    10.956886648195539    0.0
0.0    0.0    50.00000719928987

EOF

mpirun -np 192 cp.x -inp $INP_FILE > $OUTPUT_FILE
