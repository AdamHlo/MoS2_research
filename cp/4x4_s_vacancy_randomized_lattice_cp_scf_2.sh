#!/bin/bash
#SBATCH -N 3
#SBATCH --ntasks-per-node=64
#SBATCH -o slurm.txt
#SBATCH -e slurm.txt
#SBATCH --account=p376-23-1

module load QuantumESPRESSO/7.2-intel-2022a

JOB_NAME='4x4_s_vacancy_randomized_lattice_cp_scf_2'


DT=`date +"%d-%b-%Y_%H-%M-%S"`
OUT_DIR="out/${JOB_NAME}_${DT}"
INP_FILE="${OUT_DIR}/input.in"
OUTPUT_FILE="${OUT_DIR}/output.out"

mkdir -p "$OUT_DIR"


cat > $INP_FILE << EOF

&CONTROL
  calculation = 'scf'
  iprint = 1
  isave = 1
  ndr = 50
  ndw = 50
  nstep = 1
  outdir = '${OUT_DIR}'
  prefix = 'mos2'
  pseudo_dir = '../pw/pseudo/'
  restart_mode = 'from_scratch'
  verbosity = 'high'
/
&SYSTEM
  ecutwfc = 50
  ecutrho = 400
  ibrav = 0
  nat = 47
  ntyp = 2
  nr1b = 24,
  nr2b = 24,
  nr3b = 24
/
&ELECTRONS
  orthogonalization = 'ortho'
  electron_dynamics = 'cg'
  electron_maxstep = 100
  conv_thr = 0.000001
/
&CELL
/
ATOMIC_SPECIES
Mo    95.95    Mo_ONCV_PBE-1.0.oncvpsp.upf
S     32.06    s_pbe_v1.4.uspp.F.UPF

ATOMIC_POSITIONS angstrom
Mo    1.5561222949241047    0.4621845051517244    25.023005260905826
S    1.5143738355183944    2.31366956503577    26.50955830651756
S    1.596937365194365    2.333501941121129    23.45088745696794
Mo    0.01674761356705496    3.1456494731366518    25.00459294432333
S    0.007027164394586028    5.011660426327186    26.55262390029737
S    0.021223189722664595    5.021261040867902    23.487450329549002
Mo    -1.65753657493708    5.871312959380464    25.04473789868184
S    -1.616276918297344    7.682805329016237    26.57103418779684
S    -1.5856520619540329    7.774652420242157    23.480603706224414
Mo    -3.2368054386323655    8.566546021658272    25.034362439027287
S    -3.0807878301786618    10.507516092591313    26.584466507254138
S    -3.193350156787834    10.482190646593155    23.40989676580621
Mo    4.8224910007146224    0.4635253902164239    24.92982015683598
S    4.856576203711266    2.2335556066710227    26.577204489294633
S    4.707518265916534    2.3168784053331675    23.356318519865958
Mo    3.1429249886509667    3.2569572384263705    24.946142058654058
S    3.1642391574253383    4.985077509799792    26.569341625214868
S    3.196710114685208    5.041114782113386    23.44368106073263
Mo    1.5711185397480836    5.990170189512238    25.054835186745393
S    1.5437383568390834    7.780630507701719    26.544963930753017
S    1.5515063072988822    7.7265882210355015    23.452703593962436
Mo    0.09483907234409446    8.657618008727715    25.079185114220802
S    0.04594534267903703    10.521169326405593    26.5805197826221
S    -0.010965687847067394    10.485184339924352    23.415557587225727
Mo    7.917228316790326    0.4910666427442885    24.958794525003132
S    7.865872351896209    2.271281253318242    23.326341251166145
Mo    6.368743136924344    3.1306085479716144    24.90231741863227
S    6.328599297293603    4.97234590934261    26.575791763805046
S    6.362804115971726    5.0259512226641165    23.406475603283504
Mo    4.675997763950729    5.982826218571499    25.006309495475115
S    4.729504648951845    7.808319069205875    26.66024040877443
S    4.68231288150851    7.755000975191544    23.49679654588936
Mo    3.1070530172141244    8.704648437722241    25.023684389922284
S    3.0819168262606906    10.461764184744597    26.590800636166225
S    3.1678852342163553    10.484888716619038    23.397363176878102
Mo    11.077586102809317    0.49129331955658373    24.910305467976414
S    11.019577448425279    2.3200198115714366    26.602345838073724
S    11.086200149571175    2.4140035188848215    23.40483187860128
Mo    9.425766388683943    3.198187280659111    25.00907054424959
S    9.515352433150753    4.9867787259890966    26.615687053658448
S    9.471508813247299    5.044180558687658    23.419735772725343
Mo    7.870375209273263    5.770549279723171    24.958078570338646
S    7.927722186000532    7.737652652687824    26.46748022704984
S    7.985911942282629    7.782829106877007    23.499400548089003
Mo    6.345653119016419    8.762897332684735    25.003559723057574
S    6.356055094015657    10.578834023202944    26.581314025903087
S    6.310102571047328    10.41808810767126    23.48226486444393

CELL_PARAMETERS angstrom
12.651922535508914    -4.3663250128404126e-07    0.0
-6.3259616458894525    10.956886648195539    0.0
0.0    0.0    50.00000719928987

EOF

mpirun -np 192 pw.x -inp $INP_FILE > $OUTPUT_FILE
