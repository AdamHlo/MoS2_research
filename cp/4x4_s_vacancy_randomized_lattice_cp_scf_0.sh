#!/bin/bash
#SBATCH -N 3
#SBATCH --ntasks-per-node=64
#SBATCH -o slurm.txt
#SBATCH -e slurm.txt
#SBATCH --account=p376-23-1

module load QuantumESPRESSO/7.2-intel-2022a

JOB_NAME='4x4_s_vacancy_randomized_lattice_cp_scf_0'


DT=`date +"%d-%b-%Y_%H-%M-%S"`
OUT_DIR="out/${JOB_NAME}_${DT}"
INP_FILE="${OUT_DIR}/input.in"
OUTPUT_FILE="${OUT_DIR}/output.out"

mkdir -p "$OUT_DIR"


cat > $INP_FILE << EOF

&CONTROL
  calculation = 'scf'
  iprint = 1
  isave = 1
  ndr = 50
  ndw = 50
  nstep = 1
  outdir = '${OUT_DIR}'
  prefix = 'mos2'
  pseudo_dir = '../pw/pseudo/'
  restart_mode = 'from_scratch'
  verbosity = 'high'
/
&SYSTEM
  ecutwfc = 50
  ecutrho = 400
  ibrav = 0
  nat = 47
  ntyp = 2
  nr1b = 24,
  nr2b = 24,
  nr3b = 24
/
&ELECTRONS
  orthogonalization = 'ortho'
  electron_dynamics = 'cg'
  electron_maxstep = 100
  conv_thr = 0.000001
/
&CELL
/
ATOMIC_SPECIES
Mo    95.95    Mo_ONCV_PBE-1.0.oncvpsp.upf
S     32.06    s_pbe_v1.4.uspp.F.UPF

ATOMIC_POSITIONS angstrom
Mo    1.6193701600973691    0.44517828150494104    24.978163046941074
S    1.6471144970805327    2.295468620207457    26.541001029846587
S    1.5376181525532469    2.3086288273830085    23.383145185823054
Mo    0.008363186013957588    3.12800600659593    24.939891802673458
S    -0.0226420168202619    4.987038504042197    26.569565991164176
S    0.03575852412392866    5.052514668981679    23.5466769763845
Mo    -1.6163352348650664    6.023818077950248    25.04121690595843
S    -1.544235146157303    7.767838178652277    26.567242208342293
S    -1.6294658138368785    7.732922935912514    23.500951661827347
Mo    -3.153469007740636    8.613063230884459    24.976497543971103
S    -3.1450369165551564    10.449692502101497    26.577595270115886
S    -3.117181305690054    10.554216233219615    23.46836585427569
Mo    4.814731066718903    0.4578506176684914    24.994659920951545
S    4.743502922301797    2.240028593425769    26.617255252416875
S    4.686760232331805    2.2976288685806012    23.36256203652235
Mo    3.148245240592973    3.191772261530037    25.064019628935124
S    3.2162230937146057    5.076444235415398    26.64912612042661
S    3.1961151919375914    4.928053151644467    23.47304662341489
Mo    1.6903293770416736    5.917876724127927    25.016942399611477
S    1.4807255333527942    7.780390264256404    26.592930544798836
S    1.5867432089699571    7.756072004980503    23.452238653531573
Mo    0.1039355397586312    8.683892829529565    25.038217471577887
S    0.035380205057357075    10.551194122913635    26.602769422878694
S    0.036364213586265556    10.539100469387057    23.39726482439519
Mo    7.814145644214305    0.45087838689279813    24.92796471881815
S    7.976546402247033    2.215629423925365    23.366169849489722
Mo    6.424316015574315    3.135317570577572    24.953798383016363
S    6.385433159831068    4.961233578298502    26.578683032904156
S    6.3466385552336595    5.06215090960935    23.41602732625534
Mo    4.761834571499338    5.827777822835626    25.053808856337017
S    4.742861057535803    7.758156917705912    26.651995767048795
S    4.737163639280304    7.83999268260892    23.524903783576992
Mo    3.2722263724468656    8.662504477223727    25.090084142426228
S    3.1669895230433247    10.581968760913961    26.509332282837146
S    3.1245553781346462    10.452352989337452    23.391500100577808
Mo    11.082780289308953    0.43625102292051926    25.025354308351346
S    10.95724056621653    2.2138477651893833    26.55454323789605
S    11.074297148590256    2.3557318999823758    23.364746817035012
Mo    9.48633040947574    3.253292805022321    24.96025189192186
S    9.439534851932276    4.977644579382857    26.527465014676274
S    9.50664836623238    5.021320051915794    23.36635186851109
Mo    7.899657974867332    5.8114914025072455    25.014742928459118
S    7.901922741052137    7.756203788630198    26.583853572898516
S    8.014816910929    7.82186920085825    23.443355853461902
Mo    6.342230179319364    8.674797786223245    25.099315152202244
S    6.2823261433414554    10.598331121402328    26.512513857832264
S    6.344189939259129    10.41768572454136    23.494236507168207

CELL_PARAMETERS angstrom
12.651922535508914    -4.3663250128404126e-07    0.0
-6.3259616458894525    10.956886648195539    0.0
0.0    0.0    50.00000719928987

EOF

mpirun -np 192 pw.x -inp $INP_FILE > $OUTPUT_FILE
